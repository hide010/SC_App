情報セキュリティスペシャリスト午後試験ストーリー
2014年春期　午後I　問2
インターネット接続システムにおける迷惑メール対策に関する問題。
 
A君
先輩。今回はどんな案件なんですか？何か大事件でも起きて、その調査とか？
B先輩
そんな大それた話じゃあないよ。あの有名なスポーツ用品メーカーさんのセキュリティ強化のための迷惑メールの調査と対策だな。
A
迷惑メール対策か〜。しょっぱいな〜。別にわざわざ僕らが出張ってやるような案件じゃないんじゃないですか？自分で迷惑メール対策装置買ってきて、設置すりゃいいんですよ。大手企業のくせに、そんな事も出来ないんですかね〜。
B
何を言ってるんだ！迷惑メール対策は、ただ対策装置を入れるだけでは万全とは言えないし、きちんと対策しなければ、従業員の余計な手間を増やしてしまったり、逆に業務に必要なメールが届かなかったりと、非常に重要なセキュリティ対策の一つだぞ。
Cリーダー
まぁまぁ、B君もそんなにぷりぷりすんなよ。
確かにこいつの感じたとおり、迷惑メール対策というのは一見簡単そうに見えるし、セキュリティ的に重要な部分だと思われていないから、軽視されがちなのは事実だ。
しかし、広告が入った迷惑メールの中に紛れて、標的型攻撃といわれる企業を狙ったメールが最近急増している。
今回のクライアントさんも、そこまで見越してうちに依頼しているんだから、流石大手企業といったところだな。
 
チームを乗せたタクシーは、都心のベイエリアのビジネスエリアを進み、海外で活躍するサッカー選手を使った広告が大きく掲示されたビルの前で止まった。
A
さぁ、サッサと終わらせて、ベイエリアの洒落たバーで打ち上げと行きましょうか。
B
お前の奢りでな。
 
 
Fさん
お待ちしていました。今回もぜひよろしくお願いします。
B
よろしくお願いします。
早速ですが、今回の経緯と目的をお教え頂けますでしょうか。
F
はい。先週、当社の営業マンから、”2週間前から、社外が送信元とみられる迷惑メールが増加している”という連絡があり、調査してみました。結果、全ての機器は設定どおり動作しておりましたが、ログ上では確かに2週間前から迷惑メールが社内メールサーバに送られていたようです。
これを受けて、上層部からは今回の原因の調査と対策を行うよう指示されています。
B
分かりました。それでは御社のネットワーク構成図と、メール関連の機器の設定情報をご提示頂けますか。
F
これが当社のネットワーク構成図、各種機器の概要、Fwの設定ルール及び、迷惑メール対策装置の判定処理図です。
 
 
 
A
ふーん。外部からのメールはまず「迷惑メール対策装置」が受け付けて、迷惑メールを振り分けた後、安全と判定されたものだけを内部メールサーバへ転送する仕組みですね。この「迷惑メール対策装置」の振り分けを突破するメールが急増したということなら、迷惑メールの判定ルールを強化すれば解決ですよ。簡単な話じゃないですか。
B
表1をよく見てみろ。社内から社外へメールを配信する際の転送サーバである「外部メールサーバ」が、「迷惑メール対策装置」の予備として「インターネット」から「内部メールサーバ」へのメール転送を許可している。
Fさん。もしかすると、この「外部メールサーバ」から「内部メールサーバ」への転送が増加していたんじゃないでしょうか？
F
仰るとおりです。ログ上では①迷惑メールが外部メールサーバから内部メールサーバに転送されており、2週間前からその数が増加していたのです。
C
①'インターネットから「迷惑メール対策装置」を経由せずに「外部メールサーバ」宛に直接送信されてしまっていたと言う事でしょうね。
B
「外部メールサーバ」は、あくまで「迷惑メール対策装置」が故障した際にメールの受信を止めないことが目的であり、必要最低限のウィルスチェック機能のみで、迷惑メール対策機能は持っていないようです。
この場合、通常時はFw側で「インターネットから外部メールサーバ」へのSMTP通信は「拒否」し、「迷惑メール対策装置」が故障した場合だけ「許可」とする運用に変更すべきです。
F
なるほど、通常時に使用されない経路を開放していたことが、今回の根本的な迷惑メール増加に繋がっていたようですね。
具体的な対策手法ですが、Bさんにご指摘いただいたFwの設定変更だけでなく、「外部メールサーバ」「迷惑メール対策装置」をLBの配下にするようネットワーク構成を一部変更し、IPアドレス変換機能を利用して「迷惑メール対策装置」が正常に動作している場合はそのまま「迷惑メール対策装置」がメールを監査した上で「内部メールサーバ」へ転送し、もし「迷惑メール対策装置」が故障している場合、「外部メールサーバ」宛に振り分けるようにしたいと思いますが、いかがでしょうか。
 
この人、１つ指摘を受けただけで、自社ネットワーク構成に合わせた対策案をすぐ出せるなんて、かなりやり手かもしれないな。
C
それがより望ましいと思います。
さらに、図3のDNS設定も変更しておく事をお勧めします。
A
え、特に変な箇所は無いように見えるんですけど・・・
B
MXレコードに、外部メールサーバがセカンダリメールサーバとして登録されている。
これを削除しておいたほうが良いって事だな。
F
LBの機能でIPアドレス変換を行っているので、万一「迷惑メール対策機」が故障中にメールが送られてきても、LB側でそのメールを自動的に「外部メールサーバ」へ誘引してくれるから、MXレコードに外部メールサーバの情報を記載しておく必要性が無いってことですね。
C
仰る通りです。
A
なるほど、確かにそうですね。開放する必要のない経路を開放していたり、無駄な情報を外部に出したりという事は、極力しないことがセキュリティの基本ですからね。
 
B先輩がキッとこちらを睨んで、口を開こうとしたら
Fさんが苦笑いしながらそれを遮った。
F
確かに不要な経路や情報は、閉じたり隠したりするのは基本でした。
Aさん、他に当社として対策した方が望ましいポイントはありますか？
 
今回の問題の原因となっていた迷惑メールは、これで基本的には対策ができている。
やり手のFさんがわざわざ聞いてきたって事は何かありそうな予感がする。
A
迷惑メール対策ルールの見直しはやっておいた方が良い・・・かも知れないですよ。
C
ほう。良く気づいたじゃないか。
 
当てずっぽうで言ったのだが、どうもビンゴだったようだ。
B
何となく言って当たっただけなんで、褒めちゃダメですよリーダー。
こいつびっくりした顔してましたもん。
 
この人は仕事は微妙なくせに、こういう所は感が鋭い。
F
そうなんですよ。迷惑メール対策装置の「ユーザ登録ルール」全般を見直しておきたいと考えていたのです。是非、アドバイスをお願いします。
A
まず、IPアドレスWLとIPアドレスBLへの登録の効果の持続性について検討しましょう。
たとえ取引先のIPアドレスをIPアドレスWLに登録していたとしても、メールが急に届かなくなる可能性もあります。例えば、取引先のメールサーバが移転などの理由によりIPアドレスが変更になった場合ですね。こういったケースに対応するために、定期的にIPアドレスWLの登録内容をレビューする事が望ましいです。
次に、ドメイン名WLとドメイン名BLへの登録について考えていきましょうか。
A
結論としては、ドメイン名WL・BLについては、SPF判定があれば不要です。
"SPFを使えばドメイン名を詐称する迷惑メールの拒否が可能だからです。
B
途中までは良かったんだけど、今のは宜しくないな。
②迷惑メール送信者の行為によっては、迷惑メール対策装置がSPFを使って正しいと判定したサーバから送信された迷惑メールを防ぐことができないので、SPFだけでなくWL・BLの登録も必要なんだ。
A
具体的にはどういった行為ですか？
B
SPFでの迷惑メール判定というのは、メールの送信元が詐称されていないかをチェックするものだ。
だからメールの送信ドメインが詐称されていなければSPF判定では迷惑メールとして検知できない。
F
という事は、②'迷惑メールの送信者が送信元ドメインを正当に取得していた場合だと、SPF判定で検知できないということですか。
B
はい。ですからSPFの設定だけではなく、WL・BLも適切に設定する必要があります。
BLについては、例えば社内に設置されている③［プロキシサーバ］に登録されているURL BLの情報を、迷惑メール対策装置のURL BLにも登録することで精度が上がるはずです。
F
なるほど、確かにメール本文中に悪意あるサイトのURLが記載されているメールは、迷惑メールとあ判定すべきですから、③'迷惑メールの拒否率向上に効果がありそうですね。早速設定してみます。
C
今回の事象に対する対策としては以上で問題ないはずです。
ただし、御社を対象とした標的型攻撃メールが送られてくる可能性は引き続きありますので、システムで対策するだけでなく、従業員教育として次の2点は必ず周知啓蒙するようにしてくださいね。

　・不審なメールの添付ファイルを開かない。
　・不審なメール中のURLをクリックしない。
 
セキュリティ対策は攻撃者と対策者のイタチごっこであり、最終的には従業員のセキュリティ意識が鍵を握りますからね。
F
分かりました。
　・不要な経路を開放しないよう、Fwの設定変更及びLBの設定変更の実施。
　・不要な情報を開示しないよう、DNSサーバの設定変更。
　・判定精度向上のための、迷惑メール対策装置のWL・BLの設定変更。
　・授業員へのセキュリティ教育。
これらを実施していくよういたします。アドバイスありがとうございます。
A
今日もスッキリ解決しましたね。早速シャレオツなバーにでも繰り出しますか。
B
その前に、試験に出る２つの技術情報を覚えていけよ。
一つ目は、図3のDNS設定におけるSPFレコードの記述方法だ。
［　b　］に入るのは、［　-all　］

a-sha.co.jp,  IN TXT  "v-spf1 +ip4:X1.y1.z1.4 -all"　
 
このような記述をすることで、「a-sha.co.jp」ドメインを送信元としているメールは「x1.y1.z1.4 （IPv4）」からだった場合のみ信頼し、それ以外のサーバから送られてきた場合、拒否してほしいという宣言をしている事になる。
 
二つ目は、syslogだ。
 
ログを収集、転送する方式には、UNIXで一般的に使われている［　syslog　］というプロトコルを利用することが多い。これを利用することで、多種多様なシステムを運用しながらも、ログ情報を一元管理することができるようになる。
 
この二つは試験の中で空白にされて出題された事がある基礎的な知識だし、午前問題にも出てくる可能性がある。キチンと覚えておけよ。
A
はいはい。わかりましたからサッサと行きましょうよ。
 
 